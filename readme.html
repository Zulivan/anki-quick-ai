<b>Anki Quick AI</b> <a href="https://github.com/chuanqixu/anki-quick-ai/tree/main">Github Repository Link</a><br>
<br>

<b>This add-on is actively developing. Configuration parameters may be changed when the add-on was updated, but Anki does not automatically change the old configuration.
<br>
After updating the add-on, please go to the add-on configuration page and click "Restore Defaults". Sorry for the inconvenience!
</b>
<br>
<br>

The Anki Quick AI Addon is a powerful tool that lets you interact with OpenAI in Anki. It allows you to quickly collect field values from notes, interact with OpenAI using customized prompts in multiple languages, and show and play audio responses.

<br>
<br>

Features:
<ol>
<li>
Find &amp; collect field values from Anki's notes.
</li>
<li>
Interact with OpenAI using custom prompts. Multiple interactions are supported.
</li>
<li>
Show &amp; play audio of responses from OpenAI.
</li>
</ol> 

<br>
<b>Example Usage</b>
<ol>
<li>Words story: Retrieve words studied today in Anki, and send them to OpenAI to ask it to make a story using these words. Print the story and generate the audio files.</li>
<a href="https://github.com/chuanqixu/anki-quick-ai/assets/33219261/2b3da08d-a7dc-4092-9137-0828474eaf26">Example video link</a>
</ol>

<br>
<b>Install</b><br><br>

It has been submitted to Anki add-ons <a href="https://ankiweb.net/shared/info/547821970">Anki Quick AI</a>. The code is 547821970.
To install it, click "Tools-&gt;Add-ons-&gt;Get Add-ons". In the Code section, input 547821970, and then click OK. 

<br><br><br><b>Usage</b><br><br>

<b> configure the add-on before the first time you use it. </b><br>

There are several ways to run the add-on:
<ol>
<li>
Click the <code>Tools</code> button on the menu bar in the main Anki window, and then click <code>Anki Quick AI</code>. Wait for seconds for AI generation and transmission between OpenAI and your local machine. If you also generate the sound, then it may take other seconds for sound generation.
</li>
<li>
In the Browse window, click the <code>Anki Quick AI</code> button on the menu bar.
</li>
<li>
If <code>shortcut</code> is set, you can use it to run the add-on. The default shortcut is <code>Alt+A</code>.
</li>
<li>
If <code>automatic_display</code> is set to be <code>true</code>, then the add-on will automatically run if you change to the main deck window. For example, when you finish one deck, or when you change to the deck window from the study window.
</li>
</ol> 

<br><b>Settings</b> <br><br>

Double click "Tools-&gt;Add-ons-&gt;Anki Quick AI", and a config page with JSON data format will show. Some of the parameters may be effective after restarting Anki.
<ol>
<li>ai_config:</li>
<li>api_key: API key for OpenAI.</li>
<li>model: OpenAI model to be used in this addon.</li>
<li>query: Query used to search for notes. The query grammar is the same as Anki browse, which can be found in the <a href="https://docs.ankiweb.net/searching.html">official manual</a>.</li>
<li>note_field: The field whose values will be used to replace {response} placeholder in <code>prompt_list</code>. The note field can be found in "Browse-&gt;Note Types".</li>
<li>prompt_list: A list of prompts that will be sent to OpenAI. In the prompt, you can use custom placeholders, which are sandwiched with <code>#</code>, e.x., <code>#language#</code>. Placeholders will be replaced before sending to OpenAI. It is designed for you to quickly change the prompt.</li>
<li><code>#response#</code>: This is a keyword. In the first prompt, this will be replaced with a list of strings, which are values of the <code>note_field</code> in notes searched by <code>query</code>. In other prompts, this will be replaced with the previous response from OpenAI.</li>
<li><code>#language#</code>: This is a keyword. This will be replaced with <code>language_list</code> in the settings. See below.</li>
<li><code>#name#</code>: This will be replaced with the value you set in <code>placeholder</code>, see below. Do not specify "response" or "language" as the name, since they have their special usage.</li>
<li>placeholder: A dict contains customized placeholders. The key is the name of the placeholder. The value is another dict, whose key is the index of the prompt that will be replaced, and the value is the string to replace the placeholder. You cannot and do not need to specify "response" or "language".</li>
For example:    <code>json    "prompt_list": [       "My first name is #my_name#",       "My last name is #my_name#"    ],    "placeholder": {       "my_name": {          "0": "Hello",          "1": "World"       }    }</code>    The placeholder means in the 0th prompt, <code>#my_name#</code> will be replaced with <code>Hello</code>, and in the 1st prompt, <code>#my_name#</code> will be replaced with <code>World</code>.
<li>language_list: A list of languages corresponding to the sound for each response. Also, it will be used to replace the placeholder <code>#language#</code> in the prompt.</li>
<li>play_sound: Whether to use <a href="https://github.com/rany2/edge-tts">edge-tts</a> to generate the sound of the response from OpenAI.</li>
<li>automatic_display: Whether to automatically show the window choosing whether to run the addon when changing to the main page.</li>
<li>shortcut: Shortcut to run the add-on. Do not be in conflict with other shortcuts.</li>
</ol> 

<br><b>Setup (Optional)</b><br><br>

"add-on/lib" contains third-party libraries that are not supported by Anki. Currently, Anki add-ons require third-party libraries to be bundled with the source code.
<br>
Update third-party libraries: <br><code>bash cd add-on pip install -r requirements.txt --target lib</code> 

<br><br><br><b>Change Log</b> <br><br>
<b>Version 1.0.1 2023-05-27</b><br><br>
Added
<ul>
<li>Support quickly change query and note_field in the pop-up window. This will not change the default configuration.</li>
<li>Add a "Quick AI" button to the browse window to quickly click when checking the browse query, the query will be the current input query in the browse window.</li>
<li>Add a shortcut to run it quickly in the main window.</li>
<li>Support adding customized placeholders in prompts.</li>
<li>Support HTML tags in response.</li>
</ul>
Changed
<ul>
<li>Remove the progress bar of interacting with OpenAI so Anki is not blocked.</li>
<li>Change configuration files.</li>
<li>Change the response window. Now the texts can be copied.</li>
</ul>
Fixed
<ul>
<li>Sometimes it does not have permission to override the sound file.</li>
</ul> <b>Version 1.0.0 -- 2023-05-22</b><br><br>
First Version 

<br><br><br><b>License</b><br><br>
This repository is under AGPL 3.0 required by AnkiWeb for Anki Add-on. 

<br>
<br><br><b>Acknowledgement</b> <br><br>
Thanks for the inspiration and code in <a href="https://github.com/yihong0618/duolingo_remember">yihong0618/duolingo_remember</a> and <a href="https://github.com/yihong0618/shanbay_remember">yihong0618/shanbay_remember</a>.